%=========================================
% 	   Einleitung     		 =
%=========================================

\chapter{GSM Versuch}
\section{Allgemeine Beschreibung der Versuche}
Im folgenden handelt es sich um ein Test-Versuch GSM. GSM ist die Abkürzung für Global System for Mobile Communications und ein Standard für die volldigitale Mobilfunknetze. Wir haben ihn bereits kennen gelernt, da alle unsere Handys darauf beruhen. GSM ermöglicht die eigentliche Telefonie, eine Datenübertragung und das Versenden und Empfangen von SMS, Short Message Services. Mittlerweile wurden für die Datenübertragung leistungsfähigere Standards, wie UMTS und LTE entwickelt, jedoch ist GSM noch nicht wegzudenken. 

Der Versuch soll das Verständnis für die Technik vertiefen, die den reibungslosen Ablauf unserer Handygespräche ermöglicht. Zu diesem Zweck steht uns ein System zur Verfügung, das aus einer Antenne, der Technik zur Signalverarbeitung und einem Computer mit entsprechender Software besteht. 

\subsection{Versuchsaufbau}
Der Aufbau des Versuchs ist auf den ersten Blick leicht beschrieben: Unser System besteht aus einer Antenne \ref{antenne}, einem USPR \ref{uspr} und einem Computer \ref{computer}. 
%%%%%%Bild des Gesamtaufbaus%%%%%

Zusätzlich steht uns zur Generierung von GSM Paketen ein Mobiltelefon zur Verfügung. 
%%%%Bild vom Handy%%%%


%Bestandteile des Versuchsaufbaus sind zwei baugleiche Open Base Transceiver Station Systeme bestehend aus Computer und der USRP. Die USRP ist für den Empfang der Funksignale notwendig. OpenBTS läuft in unserem Fall auf einem Rechner mit Ubuntu als Betriebssystem und  besteht aus mehren Programmen. Das System modifiziert den gewöhnlichen GSM-Netzaufbau. USRP, SDR und OpenBTS übernehmen die Aufgaben von dem Base Transceiver Station und dme Base Station Controller, die Aufgabe des Mobile Switching Center wird von dem Asterisk übernommen und verbindet das Netz mit dem IP-Backbone. SDR steht für Software Defined Radio und stellt Signalverarbeitungsbibliotheken zur verfügung. 
%Es wird ein Mobiltelefon das bereits im Netz registriert ist bereit gestellt, es ist jedoch eben so gut möglich sich mit einem anderen GSM-fähigen Telefon in dem Netz anzumelden. Auf dem OpenBTS system laufen verschiedene Dienste wie etwa der echo dienst der unter der Nummer 2600 bzw eine reply-Dients für SMS unter der 411.

Die einzelnen Bauteile im Überblick:
\subsubsection{Antenne\label{antenne}}

%%Hier gehört noch ein Bild von der Antenne rein %%


Dieses Bauteil wandelt die elektromagnetischen Signale in elektrische Signale um. Antennen sind in prinzipiell in allen Geräten enthalten, die etwas mit Funktechnik zu tun haben. Dazu zählen beispielsweise Radios oder auch Handys. Die Umwandlung hat den Hintergrund, dass die elektromagnetischen Single aus der Luft nicht direkt weiterverarbeitet werden können. 

\subsubsection{USPR\label{uspr}}
Das USPR, Universal Radio Peripheral, ist eine geschlossene Einheit, die das Verarbeiten der Empfangenen Signale ermöglicht. Es ist modular aufgebaut, sodass ein breites Frequenzspektrum abgedeckt werden kann. Für unseren Versuch interessieren aber nur die Frequenzen des GSM. Das USPR wird im folgenden nicht weiter betrachtet, da es nicht der Gegenstand des Versuchs war, sondern diesen nur ermöglicht hat.
%%Bild von USPR%%


\subsubsection{Computer\label{computer}}
Der Computer mit seiner entsprechenden Software ist die für den Versuch am interessanteste Komponente. Er ermöglicht es, die empfangenen Funksignale grafisch darzustellen und auszuwerten. Weiterhin stellt der Computer die Protokolle für den reibungslosen Ablauf und eine vollwertige $U_m$ Schnittstelle zur Verfügung.

%%Bild vom Computer%%%%%

Zur Bereitstellung dieser Schnittstelle und der Protokolle wird das Softwarepaket OpenBTS genutzt. 

%Es wird an zwei Baugleichen Systemen gearbeitet die jeweils eine Universal Software Radio Peripheral anbieten (USRP). Das System läuft mit dem Programm OpenBTS und implementiert einen GSM-Protokollstack von Layer 1-3 und terminiert die höheren Schichten. Mit dem System ist es möglich die meisten GSM-Signale abzufangen und mit zu schneiden.
%Ziel des Versuches ist es die Packetdaten via Wireshark, in dem GSM-Netz von einem Anruf auf den Echo-Server sowie eine SMS an die 411 mi dem Text "info", mit zu schneiden und zu analysieren. Um sich mit den Komponenten und GSM vertraut zu machen werden zu Anfang einige Visuelle und Informative Versuche ausgeführt wie z.b. das Visualisieren von Frequenzen und das erarbeiten der mathematischen Zusammen hänge der Frequenzen.

Das Ziel des Versuchs ist es, die Paketdaten mitzuschneiden, die in einem GSM Netz auftreten. Vor dem Mitschnitt soll ein Grundverständnis über die Physik hinter dem GSM Netz geschaffen werden.

%womit und in welcher Anordnung wurde protokolliert
\section{Visualisieren von Frequenzen}
Im folgenden Versuch wird mit Hilfe zweier Tools Frequenzen empfangen und diese Visualisiert. Das Tool kal scannt alle empfangbaren Frequenzen ab, zeigt deren Downlink sowie ARFCN und die stärke des empfangenden Signals an. ARFCN steht für Absolute Radio Channel Number durch die man die Down- sowie Uplinkfrequenzen berechnen kann. Im GSM 1800 sind die ARFCN von 512 bis 885 zugeordnet. Die geringste Downlinkfrequenz bei GSM 1800 ist 1805,2 MHz. Passend dazu sind die Uplinkfrequenzen in einem Abstand von 95 Mhz, beginnend bei 1710,2 bis 1784,8 Mhz. Jedes Down und Uplink-Paar wird durch die ARFCN gekennzeichnet. Durch das Tool baudline ist es möglich die empfangenen Frequenzen zeitlich zu betrachten. Um die Benutzung zu vereinfachen benutzen wir dbusrp. 


\vspace{1 cm}
Auf der folgenden Abbildung ist zu sehen welche Frequenzen in Deutschland von welchem Providern benutzt werden. 
\begin{figure}[h]
  \centering
  \includegraphics[width=1\textwidth]{tkinhalt/gsm_bilder/providerfregtabelle.png}
  \caption{Frequenzentabelle der Provider}
  \label{fig:frequtabelle}
\end{figure}

\vspace{1 cm}
Die Berechnungen für die Frequenzen ergeben sich aus der folgenden Formeln
\vspace{0,5 cm}

 \begin{tabular}{lcr}
  fuplink = Startfrequenz +  (ARFCN -Offset )  * 0,2MHz\\
  fdownlink = fuplink + Abstand \\
  fuplink = fdownlink - Abstand \\
  ARFCN = (fuplink - Startfrequenz/0,2 MHZ) + Offset \\
 \end{tabular}


\subsection{Versuchsdurchführung}
Der Versuch zeigt als erstes die empfangbaren Frequenzen mit hilfe von kal und führt diese auf. Man suche sich eine möglichst stark presente Frequenz um diese sich visualiseren zu lassen.
\vspace{0,5 cm}

\begin{figure}[h]
  \centering
  \includegraphics[width=1\textwidth]{tkinhalt/gsm_bilder/vorhandenefreq.png}
  \caption{Anzeige der vorhandenen Frequenzen}
  \label{fig:vorhfrequenzen}
\end{figure}

Mit dem Befehl dbusrp -f <die gewählte Frequenz>  lässt sich die Frequenz anschaulich darstellen. Die Frequenzen werden in 3 Bereichen angezeigt. Die obere Anzeige zeigt das SIgnal im Zeitbereich, unten werden die Spektren der Frequenz dargestellt und mittig nach dem Wasserfallmodell. Das Wasserfallmodell zeigt wie sich die  Grundfrequenz durch abziehen oder hinzufügen von Frequenzen verändert wird.
\vspace{0,5 cm}


\begin{figure}[h]
  \centering
  \includegraphics[width=1\textwidth]{tkinhalt/gsm_bilder/visuallisierung.png}
  \caption{Eine visualisierte Frequenz}
  \label{fig:visual}
\end{figure}


\subsection{Versuchsziel}
%warum wurde protokoliert
Der Versuch gibt einen Allgemeinen Einblick in den Umfang von GSM und veranschaulicht die benutzten Frequenzen. Ausserdem werden die mathematischen zusammenhänge klarer und GSM an sich verständlicher.

\section{Anruf an die 2600}
Es soll ein Anruf auf die 2600 was dem echo-Dienst entspricht durchgeführt werden. Dazu benötigen wir den am Anfang beschriebenen Versusaufbau sowie ein GSM-Fähiges Mobiltelefon das in dem Netz registriert ist. 
Als erstes muss das OpenBTS system gestartet werden dies erfolgt über mehrere Konsolen Befehle, da OpenBTS aus mehreren Komponenten besteht. 
Zuerst muss der Authentication-Service gestartet werden dies erfolgt durch den Befehl sipauthserve. Dannach muss die SMqueue gestartet werden die für die Weiterlietung der SMS verantwortlich ist, mit dem Befehl smqueue wird der Service gestartet. Der eigentliche OpenBTS Service muss ebenfalls gestartet werden. Dieser Dienst stellt den Kern des Systems dar, alle anderen Prozesse agieren mit diesem Prozess. Ausserdem brauchen wir noch den Asterisk Service der bereits in diesem Dokument erklärt worden ist. Diesen starten wir in einer neuen Konsole mit dem Befehl asterisk -r. Alle Befehle müssen als Superuser ausgeführt werden, sonst würden die Berechtigungen dazu fehlen.
Um sich in dem Netz mit seinem eigenen Mobiltelefon registrieren zu können wählen wir das entsprechende Netz aus und erhalten unsere IMSI. Nun kann die 2600 angerufen werden und der Versuch durchgeführt werden.


\subsection{Versuchsziel}
%warum wurde protokoliert
Das Ziel dieses Versuches ist es die die mit geschnittenen Daten zu Analysieren und einen Anruf vom Aufbau bis zum Abbau mit zu verfolgen.


\subsection{Versuchsdurchführung}
%was wurde protokolliert
Nachdem wir uns registriert haben erhalten wir eine SMS mit folgendem Inhalt.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.5\textwidth]{tkinhalt/gsm_bilder/einwahlgsm.png}
  \caption{Einwahl in das GSM Netz}
  \label{fig:einwahl}
\end{figure}

Nun rufen wir die 2600 an und lassen dabei Wireshark mitlaufen um später den Rufaufbau und Datenaustausch mit zu schneiden.
Es ertönt eine Stimme und kurz darauf ist der echo-Dienst aktiv und gibt die Sprach-Daten die gesendet werden wieder zurück.


\section{Beschreibung der Verschiedenen Messungen und Ergebnisdarstellung}
%hier sollte die auswertung der Sprachdaten stehen

\section{Diskussion der Messergebnisse und Ausarbeiten der Aufgaben}
%dies beinhaltet auch die Nacharbeitung von Themen, die im Versuch als bisher nicht bekannt erkannt wurden.


\section{Senden einer SMS an die 411}
Der Selbe Versuch wie mit dem Echo-Dienst wird nun per SMS wiederholt. In diesem Fall sollen die Packetdaten einer SMS mit geschnitten werden und diese Analysiert werden.
\subsection{Versuchsdurchführung}
%was wurde protokolliert
Da wir bereits im GSM-Netz registriert sind bzw das System gestartet ist, senden wir einfach eine SMS mit dem Inhalt "info" an die 411. Als Antwort auf die SMS erhalten wir eine Antwort mit dem Inhalt der gesendeten SMS sowie weitere Informationen wie Zeiten. % was stand den da noch drin?
\subsection{Versuchsziel}
%warum wurde protokoliert
Der Versuch soll den Ablauf des Senden einer SMS veranschaulichen. 

\section{Beschreibung der Verschiedenen Messungen und Ergebnisdarstellung}

Das erste Bild zeigt das Packet das gesendet wird bei dem veschicken einer SMS. Wie man schon in der Informationsspalte sehen kann wird die SMS von dem Mobiltelefon(MS) an das Netzwerk(NW) geschickt. In dem Feld TP-USER-DATA kann man sich den geschickten Inhalt ansehen. Was in diesem Fall high ist. 
%\begin{figure}[h]
  %\centering
  %\begin{minipage}[b]{6 cm}
    %\includegraphics{tkinhalt/gsm_bilder/ms2nw.png}  
  %\end{minipage}
  %\begin{minipage}[b]{6 cm}
  %  \includegraphics{tkinhalt/gsm_bilder/nw2ms.png}  
  %\end{minipage}
  %\caption{SMS zwischen Netzwerk und Mobilstation}
  %\label{sms}
%\end{figure}
\begin{figure}[h]
  \centering
  \includegraphics[width=1\textwidth]{tkinhalt/gsm_bilder/ms2nw.png}
  \caption{SMS von Mobilstation an Netzwerk}
  \label{fig:sms1}
\end{figure}

\begin{figure}[h]
  \centering
  \includegraphics[width=1\textwidth]{tkinhalt/gsm_bilder/nw2ms.png}
  \caption{SMS von Netzwerk an Mobilestation}
  \label{fig:sms2}
\end{figure}




%\section{Diskussion der Messergebnisse und Ausarbeiten der Aufgaben}
%dies beinhaltet auch die Nacharbeitung von Themen, die im Versuch als bisher nicht bekannt erkannt wurden.





